var eshot=eshot||{};eshot.form=function(n,t){function h(n){if(!e){e=!0;i=n;y();v();c();$(t).on("submit","form",function(){return $("#Errors").val(""),$(".eshot-hook-model-error").each(function(){var n=$(this).find(".eshot-hook-model-error-msg");n.length||(n=$(this));n.html("");$(this).hide()}),!0});if(i!==undefined&&i!==null&&(s(),i.SearchId&&i.SearchOnId)){p();$("#"+i.SearchOnId).filterByText($("#"+i.SearchId));$("#"+i.SearchOnId).on("change",function(){$("#"+i.SearchId).val("")})}}}function c(){$("#divEmailLinkSend").on("click",function(){$.ajax({url:$("#aEmailLinkSend").attr("data-href"),type:"GET",processData:!1,contentType:!1,success:function(n){const t=$("#spanFailedSends"),i=$("#spanSuccessfulSends"),r=()=>t.data("errorMessage");r()||t.data("errorMessage",t.text());n.Success?(t.hide(),i.show()):(n.Error?t.text(n.Error):t.text(r()),i.hide(),t.show())},error:function(){$("#spanFailedSends").show()}})})}function l(){var i=$("#Errors").val(),n,t;i!==""&&(n=JSON.parse(i),$(".eshot-hook-model-error").each(function(){o(n,$(this))}),$(".eshot-hook-model-error:hidden").each(function(){o(n,$(this))}),t=$(".eshot-hook-model-error:visible").first(),t.length&&$("html, body").animate({scrollTop:t.offset().top}))}function o(n,t){var e=t.data("id"),i=a(n,e),f=!1,u,r;return i!==undefined&&i!==null&&i.length>0&&i.length>0&&(u=t.find(".eshot-hook-model-error-msg"),u.length||(u=t),u.html(i[0].message),f=!0),r=$("input[name='"+e+"']"),f?(t.show(),r.length&&r.addClass("input-validation-error")):(t.hide(),r.length&&r.removeClass("input-validation-error")),f}function a(n,t){return n===undefined||n===null?null:(t==="generic"&&(t=""),n.filter(function(n){return n.name==t}))}function v(){$(t).on("change",".eshot-hook-signup-day",function(){var n=$(this).closest(".eshot-hook-signup-date-parent"),t=n.find(".eshot-hook-signup-day"),i=n.find(".eshot-hook-signup-month"),r=n.find(".eshot-hook-signup-year"),f=r.find(":selected").val(),e=i.find(":selected").val(),o=t.find(":selected").val();n.find(".eshot-hook-signup-date").val(f+"-"+u(e,2)+"-"+u(o,2))});$(t).on("change",".eshot-hook-signup-month",function(){var t=$(this).closest(".eshot-hook-signup-date-parent"),n=t.find(".eshot-hook-signup-day"),r=t.find(".eshot-hook-signup-month"),f=t.find(".eshot-hook-signup-year"),e=f.find(":selected").val(),o=r.find(":selected").val(),i;n.find("option[value=29]").show();n.find("option[value=30]").show();n.find("option[value=31]").show();switch($(this).find(":selected").val()){case"9":case"4":case"6":case"11":n.val()>30&&n.val("1");n.find("option[value=31]").hide();break;case"2":n.val()>28&&n.val("1");n.find("option[value=29]").hide();n.find("option[value=30]").hide();n.find("option[value=31]").hide()}i=n.find(":selected").val();t.find(".eshot-hook-signup-date").val(e+"-"+u(o,2)+"-"+u(i,2))});$(t).on("change",".eshot-hook-signup-year",function(){var n=$(this).closest(".eshot-hook-signup-date-parent"),t=n.find(".eshot-hook-signup-day"),i=n.find(".eshot-hook-signup-month"),r=n.find(".eshot-hook-signup-year"),f=r.find(":selected").val(),e=i.find(":selected").val(),o=t.find(":selected").val();n.find(".eshot-hook-signup-date").val(f+"-"+u(e,2)+"-"+u(o,2))});$(".eshot-hook-signup-date-parent").each(function(){var t=$(this),f=$(this).find(".eshot-hook-signup-date").val(),n=f.split("-"),i=t.find(".eshot-hook-signup-day"),r=t.find(".eshot-hook-signup-month"),u=t.find(".eshot-hook-signup-year");n.length>=2?(u.val(parseInt(n[0])),r.val(parseInt(n[1])),n.length===3?i.val(parseInt(n[2])):i.val("1")):(u.val(""),r.val(""),i.val(""))})}function y(){$(".btn.btn-default.btn-expand").on("click",function(){$(this).hasClass("expanded")?$(this).removeClass("expanded"):$(this).addClass("expanded")})}function p(){jQuery.fn.filterByText=function(n){return this.each(function(){var t=this,i=[];$(t).find("option").each(function(){i.push({value:$(this).val(),text:$(this).text()})});$(t).data("options",i);$(n).bind("change keyup",function(){var n=$(t).empty().data("options"),i=$.trim($(this).val()),r=new RegExp(i,"gi");$.each(n,function(u){var f=n[u];f.text.match(r)!==null&&($(t).append($("<option>").text(f.text).val(f.value)),$(i).val="")})})})}}function w(){$(".eshot-hook-signup-date").each(function(){var i=$(this),t=i.closest(".eshot-hook-signup-date-parent"),n=i.val().split("-");if(n.length===3){var r=t.find(".eshot-hook-signup-day"),u=t.find(".eshot-hook-signup-month"),f=t.find(".eshot-hook-signup-year");n[0].length>0&&f.val(parseInt(n[0]));n[1].length>0&&u.val(parseInt(n[1]));n[2].length>0&&r.val(parseInt(n[2]))}})}function s(){i!==undefined&&i!==null&&(i.ErrorMessages!==undefined&&$("#ErrorMessagesJson").val(JSON.stringify(i.ErrorMessages)),i.Fields&&(r("SubmitButtonText",i.Fields.SubmitButtonText),r("ConsentUrlLinkText",i.Fields.ConsentUrlLinkText),r("Day",i.Fields.Day),r("Month",i.Fields.Month),r("Year",i.Fields.Year),r("January",i.Fields.January),r("February",i.Fields.February),r("March",i.Fields.March),r("April",i.Fields.April),r("May",i.Fields.May),r("June",i.Fields.June),r("July",i.Fields.July),r("August",i.Fields.August),r("September",i.Fields.September),r("October",i.Fields.October),r("November",i.Fields.November),r("December",i.Fields.December),r("ContactDetails",i.Fields.ContactDetails),r("ChooseGroups",i.Fields.ChooseGroups),r("ChoosePreferences",i.Fields.ChoosePreferences),r("True",i.Fields.True),r("False",i.Fields.False),r("UnsubscribeFromAll",i.Fields.UnsubscribeFromAll),r("PreferenceCentre",i.Fields.PreferenceCentre),i.Fields.Columns&&i.Fields.Columns!==undefined&&i.Fields.Columns!==null&&i.Fields.Columns.forEach(function(n){n&&r("Column."+n.DisplayName,n.Text)}),i.Fields.RequiredText!==undefined&&r("RequiredText",i.Fields.RequiredText)))}function b(t){var i=!0;if($("body").hide(),t===undefined?i=!1:t.url===undefined&&(i=!1),i){let i=parseInt(k("frameOptions"));switch(i){case 2:n.top.location.href=t.url;break;case 1:f?n.parent.postMessage({type:"ES_FORM_REDIRECT",redirectUrl:t.url},f):n.location.parent.href=t.url;break;case 0:default:n.location.href=t.url}f&&n.parent.postMessage({type:"ES_FORM_SUBMIT"},f)}else $("body").show(),w(),s(),l()}function k(t){t=t.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),i=r.exec(n.location.href);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function r(n,t){if(t!==undefined&&t!==null){var i=$("[data-lang-text='"+n+"']");if(i.length===0)return;i.text(t)}}var i,e=!1,f;const u=(n,t)=>String(n).padStart(t,"0");return n.addEventListener("message",n=>{switch(n.data.type){case"ES_FORM_IFRAME_INIT":f=n.origin}}),{Init:h,SubmittedForm:b}}(window,document)